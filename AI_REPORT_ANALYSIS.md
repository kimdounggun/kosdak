# AI 리포트 제거 여부 분석

## 현재 상황

### 1. AI 리포트 Content 사용처
- ✅ `AiReportViewer`: 1~4번 섹션 표시 (시장 포지션, 매매 시그널, 리스크 요인, 전망 요약)
- ✅ `ai-reports` 페이지: 전체 리포트 텍스트 표시
- ✅ **핵심**: 5번 섹션(맞춤 투자 전략)에서 `metadata.strategy` 파싱 → UI 전략 표시

### 2. 현재 제한사항
- `max_tokens: 1500` → 리포트가 짤릴 수 있음
- 특히 5번 섹션이 짤리면 전략 파싱 실패 → Fallback 사용

### 3. 실제 사용 중요도

| 항목 | 중요도 | 사용처 | 제거 가능? |
|------|-------|--------|-----------|
| 1~4번 섹션 (상세 분석) | 🟡 중간 | AiReportViewer 표시 | ✅ 제거 가능 |
| 5번 섹션 (맞춤 투자 전략) | 🔴 최고 | metadata.strategy 파싱 | ❌ 필수 |
| metadata.strategy | 🔴 최고 | UI 전략 표시 | ❌ 필수 |

## 제 생각: 3가지 옵션

### 옵션 1: 1~4번 섹션 제거, 5번 섹션만 생성 (추천 ⭐)
**장점:**
- ✅ 토큰 절약 (1500 → 800 정도)
- ✅ 5번 섹션이 완전히 생성될 확률 높음
- ✅ 전략 파싱 실패 방지
- ✅ 비용 절감 (토큰 사용량 -40%)

**단점:**
- ❌ 상세 분석 텍스트 없음 (하지만 전략이 더 중요)

**구현:**
```typescript
// 프롬프트에서 1~4번 섹션 제거, 5번 섹션만 요청
// max_tokens: 800으로 감소
```

### 옵션 2: max_tokens 증가 (2000~2500)
**장점:**
- ✅ 전체 리포트 완전히 생성
- ✅ 상세 분석 유지

**단점:**
- ❌ 비용 증가 (+33~67%)
- ❌ 여전히 짤릴 가능성 (긴 리포트)
- ❌ 응답 시간 증가

### 옵션 3: 프롬프트 간소화 (1~4번 섹션 요약)
**장점:**
- ✅ 전체 리포트 유지
- ✅ 토큰 절약

**단점:**
- ❌ 상세 분석 품질 저하
- ❌ 여전히 짤릴 가능성

## 추천: 옵션 1 (1~4번 섹션 제거)

### 이유:
1. **실제 사용**: 사용자는 전략(phase1, phase2, phase3)을 보는 것이 핵심
2. **비용 효율**: 토큰 -40%, 비용 절감
3. **안정성**: 5번 섹션이 완전히 생성되어 파싱 실패 방지
4. **UX**: 전략이 더 명확하게 표시됨

### 대안:
- 1~4번 섹션 대신 간단한 요약만 생성 (토큰 200 정도)
- 또는 metadata에만 저장하고 UI에는 표시 안 함

## 구현 방안

### 옵션 1 구현:
```typescript
// 프롬프트 수정: 1~4번 섹션 제거
// 5번 섹션만 요청
// max_tokens: 800

// 또는
// 1~4번 섹션을 매우 간단하게 (각 2~3문장)
// 5번 섹션은 상세하게
```

### 옵션 2 구현:
```typescript
max_tokens: 2500  // 1500 → 2500
```

## 최종 추천

**옵션 1 (1~4번 섹션 제거 또는 간소화)** 추천

이유:
- 전략이 핵심이고, 상세 분석은 부가적
- 비용 절감 + 안정성 향상
- 사용자는 전략 UI를 더 많이 봄












